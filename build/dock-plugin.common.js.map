{"version":3,"file":"dock-plugin.common.js","sources":["../src/utils.ts","../src/drop-strategy.ts","../src/index.ts"],"sourcesContent":["import { Component } from \"rete\";\n\nexport async function createNode(component: Component, position: { x: number, y: number }) {\n    let node = await component.createNode({});\n\n    node.position = [position.x, position.y];\n\n    return node;\n}","import { Component, NodeEditor } from \"rete\";\nimport { createNode } from \"./utils\";\n\nexport class DropStrategy {\n\n    constructor(editor: NodeEditor) {\n        editor.view.container.addEventListener('dragover', e => e.preventDefault())\n        editor.view.container.addEventListener('drop', async e => {\n            if(!e.dataTransfer) return;\n\n            const name = e.dataTransfer.getData('componentName');\n            const component = editor.components.get(name)\n\n            if(!component) throw new Error(`Component ${name} not found`)\n\n            // force update the mouse position\n            editor.view.area.pointermove(e as any as PointerEvent);\n\n            const node = await createNode(component as Component, editor.view.area.mouse);\n\n            editor.addNode(node)\n        })\n    }\n\n    addComponent(el: HTMLElement, component: Component) {\n        el.draggable = true;\n\n        el.addEventListener('dragstart', e => {\n            if(!e.dataTransfer) return;\n\n            e.dataTransfer.setData('componentName', component.name);\n        });\n    }\n\n}","import { Component, Control, NodeEditor } from 'rete';\n//import { ClickStrategy } from './click-strategy';\nimport { DropStrategy } from './drop-strategy';\nimport { Plugin } from 'rete/types/core/plugin';\n\ntype PluginWithOptions = Plugin | [Plugin, any];\ntype Params = {\n    container: HTMLElement,\n    plugins: PluginWithOptions[],\n    itemClass: string\n}\n\nfunction install(editor: NodeEditor, { container, plugins, itemClass = 'dock-item' } : Params) {\n    if (!(container instanceof HTMLElement)) throw new Error('container is not HTML element');\n\n    const copy = new NodeEditor(editor.id, editor.view.container);\n    //const clickStrategy = new ClickStrategy(editor);\n    const dropStrategy = new DropStrategy(editor);\n\n    plugins.forEach(plugin => {\n        if (Array.isArray(plugin))\n            copy.use(plugin[0], plugin[1])\n        else\n            copy.use(plugin)\n    });\n\n    editor.on('componentregister', async c => {\n        const component: Component = Object.create(c);\n        const el = document.createElement('div');\n\n        el.classList.add(itemClass)\n        container.appendChild(el);\n\n        //   clickStrategy.addComponent(el, component);\n        dropStrategy.addComponent(el, component);\n\n        component.editor = copy;\n        // eslint-disable-next-line camelcase\n        \n        copy.trigger('rendernode', {\n            el,\n            node: await component.createNode({ '__dock_plugin':'Y' }),\n            component: component.data,\n            bindSocket: () => {},\n            bindControl: (element: HTMLElement, control: Control) => {\n                copy.trigger('rendercontrol', { el: element, control });\n            }\n        });\n    });\n}\n\nexport default {\n    name: 'dock',\n    install\n}"],"names":["createNode","component","position","node","x","y","DropStrategy","editor","view","container","addEventListener","e","preventDefault","dataTransfer","name","getData","components","get","Error","area","pointermove","mouse","addNode","el","draggable","setData","install","plugins","itemClass","HTMLElement","copy","NodeEditor","id","dropStrategy","forEach","plugin","Array","isArray","use","on","c","Object","create","document","createElement","classList","add","appendChild","addComponent","data","element","control","trigger","bindSocket","bindControl"],"mappings":"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"}